CC      = gcc
LD      = ld
AR      = ar
NM      = nm
OBJCOPY = objcopy
OBJDUMP = objdump
READELF = readelf

GCC=gcc

CLIENT=client
SERVER=server
CLIENT_SRC=client.c
CLIENT_OBJ=client.o
SERVER_SRC=server.c 
SERVER_OBJ=server.o

BINS=${CLIENT} ${SERVER}
OBJS=${CLIENT_OBJ} ${SERVER_OBJ}

CFLAGS=-DTLS13 -DNO_PRINT -I${HOME}/cve-2019-11477-poc/include
#CFLAGS=-DDEBUG -DTLS13 -DNO_PRINT -I${HOME}/cve-2019-11477-poc/include

LDFLAGS=-L${HOME}/cve-2019-11477-poc/lib -lcrypto -lssl -ldl -lpthread

HOST=www.alice.com
PORT=5555
NUM_OF_THREADS=1

all: client server

client: ${CLIENT_OBJ}
	${CC} -o ${CLIENT} ${CLIENT_OBJ} ${LDFLAGS}

server: ${SERVER_OBJ}
	${CC} -o ${SERVER} ${SERVER_OBJ} ${LDFLAGS}

client.o: ${CLIENT_SRC}
	${CC} ${FLAGS} ${CFLAGS} -c $<

server.o: ${SERVER_SRC}
	${CC} ${FLAGS} ${CFLAGS} -c $<

cstart:
	export LD_LIBRARY_PATH=${HOME}/cve-2019-11477-poc/lib
	./${CLIENT} ${HOST} ${PORT} ${NUM_OF_THREADS} ${LOG_FILE}

sstart:
	export LD_LIBRARY_PATH=${HOME}/cve-2019-11477-poc/lib
	./${SERVER} ${PORT} ${LABEL}

clean:
	rm ${BINS} ${OBJS}
